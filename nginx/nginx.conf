events {
    worker_connections 1024;
}

http {
    upstream flask-ssrf {
        server flask-ssrf:5000;
    }
    
    upstream fastapi-xss {
        server fastapi-xss:8000;
    }
    
    upstream js-todo-idor {
        server js-todo-idor:80;
    }
    
    upstream client-side-login {
        server client-side-login:80;
    }
    
    upstream sqli-login {
        server sqli-login:5000;
    }
    
    upstream cmd-injection {
        server cmd-injection:5000;
    }
    
    
    upstream file-upload {
        server file-upload:5000;
    }
    
    upstream race-condition {
        server race-condition:5000;
    }
    
    upstream jwt-forgery {
        server jwt-forgery:8000;
    }

    # Rate limiting for fun (not blocking)
    limit_req_zone $binary_remote_addr zone=ctf:10m rate=10r/s;

    server {
        listen 80;
        server_name localhost;
        
#         location / {
#             return 200 '
# <!DOCTYPE html>
# <html>
# <head>
#     <title>üéØ CTF Challenge Hub</title>
#     <style>
#         body { font-family: Arial, sans-serif; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: white; padding: 20px; }
#         .hub-container { max-width: 1000px; margin: 0 auto; background: rgba(255,255,255,0.1); padding: 40px; border-radius: 20px; backdrop-filter: blur(20px); }
#         .challenge-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
#         .challenge-card { background: rgba(255,255,255,0.2); padding: 25px; border-radius: 15px; text-align: center; transition: transform 0.3s; }
#         .challenge-card:hover { transform: translateY(-5px); }
#         .challenge-link { color: #ffd700; text-decoration: none; font-weight: bold; font-size: 18px; }
#         .difficulty { padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: bold; }
#         .easy { background: #28a745; }
#         .hard { background: #dc3545; }
#     </style>
# </head>
# <body>
#     <div class="hub-container">
#         <h1 style="text-align: center; color: #ffd700; font-size: 3em;">üéØ CTF Challenge Hub</h1>
#         <p style="text-align: center; font-size: 1.2em;"><strong>"Welcome to the most fun CTF challenges ever!"</strong></p>
#         <p style="text-align: center;">üé¨ <em>"Every challenge has memes, cats, and Hollywood references!"</em></p>
        
#         <div class="challenge-grid">
#             <div class="challenge-card">
#                 <h3>üê± Flask SSRF</h3>
#                 <span class="difficulty easy">EASY</span>
#                 <p>Cats don\'t allow outsiders, but maybe insiders can sneak in!</p>
#                 <a href="/flask-ssrf/" class="challenge-link">Start Challenge ‚Üí</a>
#             </div>
            
#             <div class="challenge-card">
#                 <h3>ü¶∏‚Äç‚ôÇÔ∏è FastAPI XSS</h3>
#                 <span class="difficulty easy">EASY</span>
#                 <p>This site is so safe, even Thanos can\'t break it!</p>
#                 <a href="/fastapi-xss/" class="challenge-link">Start Challenge ‚Üí</a>
#             </div>
            
#             <div class="challenge-card">
#                 <h3>üìù JS Todo IDOR</h3>
#                 <span class="difficulty easy">EASY</span>
#                 <p>Even cats need to stay organized... or do they?</p>
#                 <a href="/js-todo-idor/" class="challenge-link">Start Challenge ‚Üí</a>
#             </div>
            
#             <div class="challenge-card">
#                 <h3>üé¨ Client-Side Login</h3>
#                 <span class="difficulty easy">EASY</span>
#                 <p>In Hollywood, you can be anything... even admin!</p>
#                 <a href="/client-side-login/" class="challenge-link">Start Challenge ‚Üí</a>
#             </div>
            
#             <div class="challenge-card">
#                 <h3>üï∂Ô∏è Telnet Buffer Overflow</h3>
#                 <span class="difficulty easy">EASY</span>
#                 <p>You\'ve broken into the Matrix. Neo is impressed.</p>
#                 <p><strong>Port:</strong> 5005 (telnet localhost 5005)</p>
#             </div>
            
#             <div class="challenge-card">
#                 <h3>üê± SQL Injection</h3>
#                 <span class="difficulty easy">EASY</span>
#                 <p>Where your fish savings are safe... or are they?</p>
#                 <a href="/sqli-login/" class="challenge-link">Start Challenge ‚Üí</a>
#             </div>
            
#             <div class="challenge-card">
#                 <h3>üèì Command Injection</h3>
#                 <span class="difficulty easy">EASY</span>
#                 <p>Ping like a cat - fast and precise!</p>
#                 <a href="/cmd-injection/" class="challenge-link">Start Challenge ‚Üí</a>
#             </div>
            
#             <div class="challenge-card">
#                 <h3>üîê Basic Crypto</h3>
#                 <span class="difficulty easy">EASY</span>
#                 <p>Where cats learn the ancient art of secret messages!</p>
#                 <a href="/basic-crypto/" class="challenge-link">Start Challenge ‚Üí</a>
#             </div>
            
#             <div class="challenge-card">
#                 <h3>üì∏ File Upload</h3>
#                 <span class="difficulty easy">EASY</span>
#                 <p>Share your cutest cat photos... and more!</p>
#                 <a href="/file-upload/" class="challenge-link">Start Challenge ‚Üí</a>
#             </div>
            
#             <div class="challenge-card">
#                 <h3>üè¶ Race Condition</h3>
#                 <span class="difficulty hard">HARD</span>
#                 <p>Where fast cats make fast money!</p>
#                 <a href="/race-condition/" class="challenge-link">Start Challenge ‚Üí</a>
#             </div>
            
#             <div class="challenge-card">
#                 <h3>üîê JWT Forgery</h3>
#                 <span class="difficulty hard">HARD</span>
#                 <p>Ultra-secure JWT authentication... or is it?</p>
#                 <a href="/jwt-forgery/" class="challenge-link">Start Challenge ‚Üí</a>
#             </div>
#         </div>
        
#         <div style="margin-top: 50px; text-align: center; font-size: 14px; opacity: 0.8;">
#             <p>üé≠ <em>"Have fun and happy hacking! Remember: Always be ethical!"</em></p>
#             <p>üê± <em>All flags follow the format: nulleec{...}</em></p>
#         </div>
#     </div>
# </body>
# </html>
#             ';
#             add_header Content-Type text/html;
#         }
        
        # Challenge proxies
        location /flask-ssrf/ {
            proxy_pass http://flask-ssrf/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /fastapi-xss/ {
            proxy_pass http://fastapi-xss/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /js-todo-idor/ {
            proxy_pass http://js-todo-idor/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /client-side-login/ {
            proxy_pass http://client-side-login/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /sqli-login/ {
            proxy_pass http://sqli-login/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /cmd-injection/ {
            proxy_pass http://cmd-injection/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
      
        location /file-upload/ {
            proxy_pass http://file-upload/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /race-condition/ {
            proxy_pass http://race-condition/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /jwt-forgery/ {
            proxy_pass http://jwt-forgery/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}